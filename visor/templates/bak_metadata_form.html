{% load static %}
{% load django_bootstrap5 %}

<div class="modal fade show d-block" id="metaModal" tabindex="-1" aria-modal="true" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
    <div class="modal-content border-0 shadow-lg">

      {{ form.media }}

      <div class="modal-header bg-primary bg-gradient text-white py-2">
        <h5 class="modal-title fw-semibold small mb-0">
          Edit metadata Â· <code>{{ filename }}</code>
        </h5>
      </div>

      <div class="flex flex-col md:flex-row gap-4">
    <!-- LEFT: Image -->
        <div class="md:w-1/2 w-full">
          <img src="{{ MEDIA_URL }}{{ filename }}"
               alt="{{ filename }}"
               class="w-full rounded shadow object-contain max-h-[80vh]" />
        </div>

    <!-- RIGHT: Metadata form -->
        <div class="md:w-1/2 w-full">

          <form
            hx-post="{% url 'visor:edit' filename %}"
            hx-target="#modal"
            hx-swap="innerHTML"
            class="space-y-4"
          >
            {% csrf_token %}
            <div class="modal-body py-3">
              <div class="container-fluid">
                <div class="row g-4">
                  {% bootstrap_field form.title size='sm' %}
                  {% bootstrap_field form.author size='sm' %}
                  <div class="row g-2">
                    <div class="col-6">
                      {% bootstrap_field form.year size='sm' %}
                    </div>
                    <div class="col-6">
                      {% bootstrap_field form.museum size='sm' %}
                    </div>
                  </div>
                  {% bootstrap_field form.material size='sm' %}
                  <div class="mb-3">
                    {% bootstrap_field form.tags size='sm' %}
                  </div>
                  {% bootstrap_field form.description rows=5 size='sm' %}
                  {% bootstrap_field form.source placeholder='https://example.com' size='sm' %}
                </div>
              </div>
            </div>

            <div class="modal-footer bg-light py-2">
              <button type="button" class="btn btn-outline-secondary btn-sm" onclick="closeModal()">Cancel</button>
              <button type="submit" class="btn btn-success btn-sm px-4">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    function closeModal() {
      const modal = document.getElementById("modal");
      if (modal) {
        modal.innerHTML = '';
        modal.classList.add("hidden");
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeModal();
      }
    });
  </script>
